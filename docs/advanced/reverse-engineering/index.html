<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper plugin-docs plugin-id-default docs-version-current docs-doc-page docs-doc-id-advanced/reverse-engineering/index" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.0.0">
<title data-rh="true">Reverse Engineering Guide | Upsy Desky</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://upsy-desky.tjhorner.dev/docs/advanced/reverse-engineering/"><meta data-rh="true" property="og:locale" content="en"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="Reverse Engineering Guide | Upsy Desky"><meta data-rh="true" name="description" content="If your desk is not officially supported, or if you are having issues with functionality like getting or setting desk height, presets, etc. and have followed the Troubleshooting steps, then it is very possible that your desk uses a protocol that the firmware does not yet understand."><meta data-rh="true" property="og:description" content="If your desk is not officially supported, or if you are having issues with functionality like getting or setting desk height, presets, etc. and have followed the Troubleshooting steps, then it is very possible that your desk uses a protocol that the firmware does not yet understand."><link data-rh="true" rel="icon" href="/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://upsy-desky.tjhorner.dev/docs/advanced/reverse-engineering/"><link data-rh="true" rel="alternate" href="https://upsy-desky.tjhorner.dev/docs/advanced/reverse-engineering/" hreflang="en"><link data-rh="true" rel="alternate" href="https://upsy-desky.tjhorner.dev/docs/advanced/reverse-engineering/" hreflang="x-default"><link data-rh="true" rel="preconnect" href="https://N36PZOL6ZV-dsn.algolia.net" crossorigin="anonymous"><link rel="search" type="application/opensearchdescription+xml" title="Upsy Desky" href="/opensearch.xml">
<link rel="preconnect" href="https://umami.horner.tj">
<script async defer="defer" src="https://umami.horner.tj/umami.js" data-website-id="d23d5a58-51a7-47a7-a3dd-2793734b2e5c" data-auto-track></script><link rel="stylesheet" href="/assets/css/styles.da4159ff.css">
<script src="/assets/js/runtime~main.50bec74f.js" defer="defer"></script>
<script src="/assets/js/main.faeb01c8.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return localStorage.getItem("theme")}catch(t){}}();null!==e?t(e):window.matchMedia("(prefers-color-scheme: dark)").matches?t("dark"):window.matchMedia("(prefers-color-scheme: light)").matches?t("light"):t("dark")}(),function(){try{const c=new URLSearchParams(window.location.search).entries();for(var[t,e]of c)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id="__docusaurus"><div role="region" aria-label="Skip to main content"><a class="skipToContent_Jej2" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/logo-long.png" alt="Upsy Desky Logo" class="themedComponent_DJv9 themedComponent--light_Ltxe"><img src="/img/logo-inverted.png" alt="Upsy Desky Logo" class="themedComponent_DJv9 themedComponent--dark_YIaN"></div></a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/docs/introduction">Docs</a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/tjhorner/upsy-desky" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_gOw0"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><a href="https://discord.gg/ZHfXKQrSxF" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">Discord<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_gOw0"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><div class="toggle_Q8DZ colorModeToggle_WPKh"><button class="clean-btn toggleButton_xX3B toggleButtonDisabled_T3va" type="button" disabled="" title="Switch between dark and light mode (currently dark mode)" aria-label="Switch between dark and light mode (currently dark mode)" aria-live="polite"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_UxP5"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_qIBZ"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="navbarSearchContainer_tMLQ"><button type="button" class="DocSearch DocSearch-Button" aria-label="Search"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">Search</span></span><span class="DocSearch-Button-Keys"></span></button></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_pjZQ"><div class="docsWrapper_yNJd"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_rsKc" type="button"></button><div class="docRoot_lvFb"><aside class="theme-doc-sidebar-container docSidebarContainer_SbV2"><div class="sidebarViewport_ltWh"><div class="sidebar_ZanS"><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_jUB4"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/introduction">Introduction</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/getting-started">Getting Started</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/byoe/">BYOE (Bring-Your-Own-Enclosure)</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/docs/configuration/">Configuration</a><button aria-label="Expand sidebar category &#x27;Configuration&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/docs/integrations/">Integrations</a><button aria-label="Expand sidebar category &#x27;Integrations&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/firmware-updates">Firmware Updates</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/docs/troubleshooting/">Troubleshooting &amp; Support</a><button aria-label="Expand sidebar category &#x27;Troubleshooting &amp; Support&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/docs/reference/api">Reference</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" aria-expanded="true" href="/docs/advanced/bluetooth-proxy">Advanced</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/advanced/bluetooth-proxy">Bluetooth Proxy</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/advanced/customization/">Firmware Customization</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/docs/advanced/reverse-engineering/">Reverse Engineering Guide</a></li></ul></li></ul></nav></div></div></aside><main class="docMainContainer_wO2h"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_pLOy"><div class="docItemContainer_tLNI"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer__LN5" aria-label="Breadcrumbs"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YWeh"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li class="breadcrumbs__item"><span class="breadcrumbs__link">Advanced</span><meta itemprop="position" content="1"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">Reverse Engineering Guide</span><meta itemprop="position" content="2"></li></ul></nav><div class="tocCollapsible_sW8G theme-doc-toc-mobile tocMobile_x9Gm"><button type="button" class="clean-btn tocCollapsibleButton_hfjZ">On this page</button></div><div class="theme-doc-markdown markdown"><h1>Reverse Engineering Guide</h1>
<p>If your desk is not officially supported, or if you are having issues with functionality like getting or setting desk height, presets, etc. and have followed the <a href="/docs/troubleshooting/">Troubleshooting</a> steps, then it is very possible that your desk uses a protocol that the firmware does not yet understand.</p>
<p>The protocols for standing desk control boxes are not usually published by their manufacturer, so we have to reverse engineer the communication between the keypad and control box as a man in the middle. Luckily, the hardware for the Upsy Desky is well-suited for this, since we have GPIO on both the RX and TX lines for the control box. No additional debugging hardware required!</p>
<p>This guide will go over the basic steps required in order to first capture the messages between the control box and keypad, then analyze them to create a decoder implementation (this is the component which provides the current height) in the ESPHome component that powers the firmware. I will use the Uplift v2 as an example throughout the guide, since that&#x27;s the standing desk I have.</p>
<h2 class="anchor anchorWithStickyNavbar_UaZB" id="capturing-messages">Capturing Messages<a href="#capturing-messages" class="hash-link" aria-label="Direct link to Capturing Messages" title="Direct link to Capturing Messages">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_UaZB" id="flashing-firmware">Flashing Firmware<a href="#flashing-firmware" class="hash-link" aria-label="Direct link to Flashing Firmware" title="Direct link to Flashing Firmware">​</a></h3>
<p>Most standing desks communicate with UART, so I&#x27;ve compiled a special firmware with all the necessary ESPHome components to log all the RX/TX messages to the console for further analysis. The ESPHome config file roughly looks like this:</p>
<div class="language-yaml codeBlockContainer_k_qd theme-code-block" style="--prism-color:#9CDCFE;--prism-background-color:#1E1E1E"><div class="codeBlockContent_I7Jj"><pre tabindex="0" class="prism-code language-yaml codeBlock_X9_o thin-scrollbar" style="color:#9CDCFE;background-color:#1E1E1E"><code class="codeBlockLines_xT00"><span class="token-line" style="color:#9CDCFE"><span class="token key atrule">logger</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token key atrule">level</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token plain"> DEBUG</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token comment" style="color:rgb(106, 153, 85)"># UART logging is from the perspective of the handset, i.e.:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token comment" style="color:rgb(106, 153, 85)"># - TX is the data sent from the handset to the control box</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token comment" style="color:rgb(106, 153, 85)"># - RX is the data sent from the control box to the handset</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token key atrule">uart</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(212, 212, 212)">-</span><span class="token plain"> </span><span class="token comment" style="color:rgb(106, 153, 85)"># Direction: Handset -&gt; Control Box</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token key atrule">id</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token plain"> handset_tx</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token key atrule">baud_rate</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token plain"> </span><span class="token number" style="color:rgb(181, 206, 168)">9600</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token key atrule">rx_pin</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token plain"> </span><span class="token number" style="color:rgb(181, 206, 168)">17</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token key atrule">debug</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token plain"> </span><span class="token important">&amp;uart_debug</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">      </span><span class="token key atrule">direction</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token plain"> RX</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">      </span><span class="token key atrule">dummy_receiver</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token plain"> </span><span class="token boolean important">true</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">      </span><span class="token key atrule">after</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">        </span><span class="token key atrule">timeout</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token plain"> 50ms</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">      </span><span class="token key atrule">sequence</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(212, 212, 212)">-</span><span class="token plain"> </span><span class="token key atrule">lambda</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token plain"> UARTDebug</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token plain">log_hex(uart</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token plain">UART_DIRECTION_TX</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> bytes</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> &#x27;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token plain">&#x27;);</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(212, 212, 212)">-</span><span class="token plain"> </span><span class="token comment" style="color:rgb(106, 153, 85)"># Direction: Control Box -&gt; Handset</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token key atrule">id</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token plain"> handset_rx</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token key atrule">baud_rate</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token plain"> </span><span class="token number" style="color:rgb(181, 206, 168)">9600</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token key atrule">rx_pin</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token plain"> </span><span class="token number" style="color:rgb(181, 206, 168)">16</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token key atrule">debug</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">      </span><span class="token key atrule">&lt;&lt;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token plain"> </span><span class="token important">*uart_debug</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">      </span><span class="token key atrule">sequence</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(212, 212, 212)">-</span><span class="token plain"> </span><span class="token key atrule">lambda</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token plain"> UARTDebug</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token plain">log_hex(uart</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token plain">UART_DIRECTION_RX</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> bytes</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> &#x27;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token plain">&#x27;);</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token comment" style="color:rgb(106, 153, 85)"># Other supporting components omitted for brevity</span><br></span></code></pre><div class="buttonGroup_TeVO"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_QMts" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_o2X6"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_xmLG"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_UaZB" id="generating-captures">Generating Captures<a href="#generating-captures" class="hash-link" aria-label="Direct link to Generating Captures" title="Direct link to Generating Captures">​</a></h3>
<p>Now that we have a way to capture UART messages between the two devices, we need to perform actions that send the messages we want to analyze. Basically, you&#x27;ll need to press the buttons on your keypad corresponding to the action you want to intercept or perform. Since we are building a decoder, we will want to analyze the messages from the control box which informs the keypad of the current height.</p>
<p>Once you have the Upsy Desky connected to both the control box and keypad, you will want to go to its web page by visiting the IP (or by viewing the ESPHome logs through the dashboard or CLI). Then raise your desk to its maximum height, then lower to the minimum height. This will give us a comprehensive capture of what the structure of the packet looks like, and what the range of heights can be.</p>
<p>On my Uplift v2 desk, here is what part of my ESPHome log looks like:</p>
<div class="language-log codeBlockContainer_k_qd theme-code-block" style="--prism-color:#9CDCFE;--prism-background-color:#1E1E1E"><div class="codeBlockContent_I7Jj"><pre tabindex="0" class="prism-code language-log codeBlock_X9_o thin-scrollbar" style="color:#9CDCFE;background-color:#1E1E1E"><code class="codeBlockLines_xT00"><span class="token-line" style="color:#9CDCFE"><span class="token plain">20:55:45 | [D] | [uart_debug:114] | &gt;&gt;&gt; 81:F5:01:01:01:44:01:01:01:44:01:01:01:44:01:01:01:44:01:01:01:44:01:01:01:44:01:01:01:44:01:01:01:44:01:01:01:44:01:01:01:44:01:01:01:44:01:01:01:44:01:01:01:44:01:01:01:44:01:01:01:44:01:01:01:44:01:01:01:44:01:01:01:45:01:01:01:45:01:01:01:45:01:01:01:45:01:01:01:45:01:01:01:45:01:01:01:46:01:01:01:46:01:01:01:46:01:01:01:47:01:01:01:47:01:01:01:47:01:01:01:47:01:01:01:47:01:01:01:48:01:01:01:48:01:01:01:48:01:01:01:49:01:01:01:49:01:01:01:49</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">20:55:46 | [D] | [uart_debug:114] | &gt;&gt;&gt; 01:01:01:49:01:01:01:4A:01:01:01:4A:01:01:01:4A:01:01:01:4B:01:01:01:4B:01:01:01:4B:01:01:01:4B:01:01:01:4B:01:01:01:4C:01:01:01:4C:01:01:01:4D:01:01:01:4D:01:01:01:4D:01:01:01:4D:01:01:01:4E:01:01:01:4E:01:01:01:4E:01:01:01:4F:01:01:01:4F:01:01:01:4F:01:01:01:4F:01:01:01:50:01:01:01:50:01:01:01:50:01:01:01:51:01:01:01:51:01:01:01:51:01:01:01:51:01:01:01:51:01:01:01:52:01:01:01:52:01:01:01:52:01:01:01:52:01:01:01:52:01:01:01:53:01:01:01:53:01:01</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">20:55:46 | [D] | [uart_debug:114] | &gt;&gt;&gt; 01:53:01:01:01:53:01:01:01:53:01:01:01:53:01:01:01:53:01:01:01:53:01:01:01:53:01:01:01:53:01:01:01:53:01:01:01:53:01:01:01:53:01:01:01:53:01:01:01:53:01:01:01:53:01:01:01:53:01:01:01:53:01:01:01:53:01:01:01:53:01:01:01:53:01:01:01:53:01:01:01:53:01:01:01:53:01:01:01:53:01:01:01:53:01:01:01:53:01:01:01:53:01:01:01:53:01:01:01:53:01:01:01:53:01:01:01:53:01:01:01:53:01:01:01:53:01:01:01:53:01:01:01:53:01:01:01:53:01:01:01:53:01:01:01:53:01:01:01:53</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">20:55:47 | [D] | [uart_debug:114] | &gt;&gt;&gt; 01:01:01:53:01:01:01:53:01:01:01:53:01:01:01:53:01:01:01:53:01:01:01:53:01:01:01:53:01:01:01:53:01:01:01:53:01:01:01:53:01:01:01:53:01:01:01:53:01:01:01:53:01:01:01:53:01:01:01:53:01:01:01:53:01:01:01:53:01:01:01:53:01:01:01:53:01:01:01:53:01:01:01:53:01:01:01:53:01:01:01:53:01:01:01:53:01:01:01:53:01:01:01:53:01:01:01:53:01:01:01:53:01:01:01:53:01:01:01:53:01:01:01:53:01:01:01:53:01:01:01:53:01:01:01:53:01:01:01:53:01:01:01:53:01:01:01:53:01:01</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">20:55:48 | [D] | [uart_debug:114] | &gt;&gt;&gt; 01:53:01:01:01:53:01:01:01:53:01:01:01:53:01:01:01:53:01:01:01:53:01:01:01:53:01:01:01:53:01:01:01:53:01:01:01:53:01:01:01:53:01:01:01:53:01:01:01:53:01:01:01:53:01:01:01:53:01:01:01:53:01:01:01:53:01:01:01:53:01:01:01:53:01:01:01:53:01:01:01:53:01:01:01:53:01:01:01:53:01:01:01:53:01:01:01:53:01:01:01:53:01:01:01:53:01:01:01:53:01:01:01:53:01:01:01:53:01:01:01:53:01:01:01:53:01:01:01:53:01:01:01:53:01:01:01:53:01:01:01:53:01:01:01:53:01:01:01:53</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">20:55:48 | [D] | [uart_debug:114] | &gt;&gt;&gt; 01:01:01:53:01:01:01:53:01:01:01:53:01:01:01:53:01:01:01:53:01:01:01:53:01:01:01:53:01:01:01:53:01:01:01:53:01:01:01:53:01:01:01:53:01:01:01:53:01:01:01:53:01:01:01:53:01:01:01:53:01:01:01:53:01:01:01:53:01:01:01:53:01:01:01:53:01:01:01:53:01:01:01:53:01:01:01:53:01:01:01:53:01:01:01:53:01:01:01:53:01:01:01:53:01:01:01:53:01:01:01:53:01:01:01:53:01:01:01:53:01:01:01:53:01:01:01:53:01:01:01:53:01:01:01:53:01:01:01:53:01:01:01:53:01:01:01:53:01:01</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">20:55:49 | [D] | [uart_debug:114] | &gt;&gt;&gt; 01:53:01:01:01:53:01:01:01:53:01:01:01:53:01:01:01:53:01:01:01:53:01:01:01:53:01:01:01:53:01:01:01:53:01:01:01:53:01:01:01:53:01:01:01:53:01:01:01:53:01:01:01:53:01:01:01:53:01:01:01:53:01:01:01:53:01:01:01:53:01:01:01:53:01:01:01:53:01:01:01:53:01:01:01:53:01:01:01:53:01:01:01:53:01:01:01:53:01:01:01:53:01:01:01:53:01:01:01:53:01:01:01:53:01:01:01:53:01:01:01:53:01:01:01:53:01:01:01:53:01:01:01:53:01:01:01:53:01:01:01:53:01:01:01:53:01:01:01:53</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">20:55:50 | [D] | [uart_debug:114] | &gt;&gt;&gt; 01:01:01:53:01:01:01:53:01:01:01:53:01:01:01:53:01:01:01:53:01:01:01:53:01:01:01:53:01:01:01:53:01:01:01:53:01:01:01:53:01:01:01:53:01:01:01:53:01:01:01:53:01:01:01:53:01:01:01:53:01:01:01:53:01:01:01:53:01:01:01:53:01:01:01:53:01:01:01:53:01:01:01:53:01:01:01:53:01:01:01:53:01:01:01:53:01:01:01:53:01:01:01:53:01:01:01:53:01:01:01:53:01:01:01:53:01:01:01:53:01:01:01:53:01:01:01:53:01:01:01:53:01:01:01:53:01:01:01:53:01:01:01:53:01:01:01:53:01:01</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">20:55:51 | [D] | [uart_debug:114] | &gt;&gt;&gt; 01:53:01:01:01:53:01:01:01:53:01:01:01:53:01:01:01:53:01:01:01:53:01:01:01:53:01:01:01:53:01:01:01:53:01:01:01:53:01:01:01:53:01:01:01:53:01:01:01:53:01:01:01:53:01:01:01:53:01:01:01:53:01:01:01:53:01:01:01:53:01:01:01:53:01:01:01:53:01:01:01:53:01:01:01:53:01:01:01:53:01:01:01:53:01:01:01:53:01:01:01:53:01:01:01:53:01:01:01:53:01:01:01:53:01:01:01:53:01:01:01:53:01:01:01:53:01:01:01:53:01:01:01:53:01:01:01:53:01:01:01:53:01:01:01:53:01:01:01:53</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">20:55:51 | [D] | [uart_debug:114] | &gt;&gt;&gt; 01:01:01:53:01:01:01:53:01:01:01:53:01:01:01:53:01:01:01:53:01:01:01:53:01:01:01:53:01:01:01:53:01:01:01:53:01:01:01:53:01:01:01:53:01:01:01:53:01:01:01:53:01:01:01:53:01:01:01:53:01:01:01:53:01:01:01:53:01:01:01:53:01:01:01:53:01:01:01:53:01:01:01:53:01:01:01:53:01:01:01:53:01:01:01:53:01:01:01:53:01:01:01:53:01:01:01:53:01:01:01:53:01:01:01:53:01:01:01:53:01:01:01:53:01:01:01:53:01:01:01:53:01:01:01:53:01:01:01:53:01:01:01:53:01:01:01:53:01:01</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">20:55:52 | [D] | [uart_debug:114] | &gt;&gt;&gt; 01:53:01:01:01:53:01:01:01:53:01:01:01:53:01:01:01:53:01:01:01:53:01:01:01:53:01:01:01:53:01:01:01:53:01:01:01:53:01:01:01:53:01:01:01:53:01:01:01:53:01:01:01:53:01:01:01:53:01:01:01:53:01:01:01:53:01:01:01:53:01:01:01:53:01:01:01:53:01:01:01:53:01:01:01:53:01:01:01:53:01:01:01:53:01:01:01:53:01:01:01:53:01:01:01:53:01:01:01:53:01:01:01:53:01:01:01:53:01:01:01:53:01:01:01:53:01:01:01:53:01:01:01:53:01:01:01:53:01:01:01:53:01:01:01:53:01:01:01:53</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">20:55:53 | [D] | [uart_debug:114] | &gt;&gt;&gt; 01:01:01:53:01:01:01:53:01:01:01:53:01:01:01:53:01:01:01:53:01:01:01:53:01:01:01:53:01:01:01:53:01:01:01:53:01:01:01:53:01:01:01:53:01:01:01:53:01:01:01:53:01:01:01:53:01:01:01:53:01:01:01:53:01:01:01:53:01:01:01:53:01:01:01:53:01:01:01:53:01:01:01:53:01:01:01:53:01:01:01:53:01:01:01:53:01:01:01:53:01:01:01:53:01:01:01:53:01:01:01:53:01:01:01:53:01:01:01:53:01:01:01:53:01:01:01:53:01:01:01:53:01:01:01:53:01:01:01:53:01:01:01:53:01:01:01:53:01:01</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">20:55:53 | [D] | [uart_debug:114] | &gt;&gt;&gt; 01:53:01:01:01:53:01:01:01:53:01:01:01:53:01:01:01:53:01:01:01:53:01:01:01:53:01:01:01:53:01:01:01:53:01:01:01:53:01:01:01:53:01:01:01:53:01:01:01:53:01:01:01:53:01:01:01:53:01:01:01:53:01:01:01:53:01:01:01:53:01:01:01:53:01:01:01:53:01:01:01:53:01:01:01:53:01:01:01:53:01:01:01:53:01:01:01:53:01:01:01:53:01:01:01:53:01:01:01:53:01:01:01:53:01:01:01:53:01:01:01:53:01:01:01:53:01:01:01:53:01:01:01:53:01:01:01:53:01:01:01:53:01:01:01:53:01:01:01:53</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">20:55:54 | [D] | [uart_debug:114] | &gt;&gt;&gt; 01:01:01:53:01:01:01:53:01:01:01:53:01:01:01:53:01:01:01:53:01:01:01:53:01:01:01:53:01:01:01:53:01:01:01:53:01:01:01:53:01:01:01:53:01:01:01:53:01:01:01:53:01:01:01:53:01:01:01:53:01:01:01:53:01:01:01:53:01:01:01:53:01:01:01:53:01:01:01:53:01:01:01:53:01:01:01:53:01:01:01:53:01:01:01:53:01:01:01:53:01:01:01:53:01:01:01:53:01:01:01:53:01:01:01:53:01:01:01:53:01:01:01:53:01:01:01:53:01:01:01:53:01:01:01:53:01:01:01:53:01:01:01:53:01:01:01:53:01:01</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">20:55:55 | [D] | [uart_debug:114] | &gt;&gt;&gt; 01:53:01:01:01:53:01:01:01:53:01:01:01:53:01:01:01:53:01:01:01:53:01:01:01:53:01:01:01:53:01:01:01:53:01:01:01:53:01:01:01:53:01:01:01:53:01:01:01:53:01:01:01:53:01:01:01:53:01:01:01:53:01:01:01:53:01:01:01:53:01:01:01:53:01:01:01:53:01:01:01:53:01:01:01:53:01:01:01:53:01:01:01:53:01:01:01:53:01:01:01:53:01:01:01:53:01:01:01:53:01:01:01:53:01:01:01:53:01:01:01:53:01:01:01:53:01:01:01:53:01:01:01:53:01:01:01:53:01:01:01:53:01:01:01:53:01:01:01:53</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">20:55:55 | [D] | [uart_debug:114] | &gt;&gt;&gt; 01:01:01:53:01:01:01:53:01:01:01:53:01:01:01:53:01:01:01:53:01:01:01:53:01:01:01:53:01:01:01:53:01:01:01:53:01:01:01:53:01:01:01:53:01:01:01:53:01:01:01:53:01:01:01:53:01:01:01:53:01:01:01:53:01:01:01:53:01:01:01:53:01:01:01:53:01:01:01:53:01:01:01:53:01:01:01:53:01:01:01:53:01:01:01:53:01:05</span><br></span></code></pre><div class="buttonGroup_TeVO"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_QMts" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_o2X6"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_xmLG"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>For this capture, I raised my desk from 32.4 inches to 33.9 inches.</p>
<h2 class="anchor anchorWithStickyNavbar_UaZB" id="analyzing-messages">Analyzing Messages<a href="#analyzing-messages" class="hash-link" aria-label="Direct link to Analyzing Messages" title="Direct link to Analyzing Messages">​</a></h2>
<p>Your capture may just look like a bunch of random hex numbers, but look close enough and we can see a pattern forming: the messages usually start and end the same way. We can group a sample of the packets based on this pattern and begin to determine the basic structure. You will mostly have to use your intuition to determine the format of the messages.</p>
<p>Here is a sample of messages that I have organized based on this method:</p>
<div class="language-log codeBlockContainer_k_qd theme-code-block" style="--prism-color:#9CDCFE;--prism-background-color:#1E1E1E"><div class="codeBlockContent_I7Jj"><pre tabindex="0" class="prism-code language-log codeBlock_X9_o thin-scrollbar" style="color:#9CDCFE;background-color:#1E1E1E"><code class="codeBlockLines_xT00"><span class="token-line" style="color:#9CDCFE"><span class="token plain">01:01:01:44</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">01:01:01:45</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">01:01:01:46</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">... some more messages</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">01:01:01:53</span><br></span></code></pre><div class="buttonGroup_TeVO"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_QMts" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_o2X6"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_xmLG"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>From this we can determine that my desk&#x27;s control box sends the height data in a set of four bytes, repeating until the display on the keypad goes inactive after a timeout of around 10 seconds.</p>
<p>Next, let&#x27;s try to determine what each byte means, and where we can find the height in this message. If you&#x27;ve ever used an old video game trainer or Cheat Engine, then you should find yourself familiar with this process 😄</p>
<p>Let&#x27;s try to find the height first. If we can reliably determine how the height is represented in each packet, we don&#x27;t necessarily need to know what the other bytes mean and ignore them. The bytes we&#x27;re looking for are rapidly changing from packet to packet, as well as either incrementing or decrementing in a near-linear fashion, since during our capture we were either lowering or raising the desk.</p>
<p>If we take a look at the first message and last message in my Uplift v2 capture, we can determine that the third and fourth bytes represent the current height of the desk in the configured units (in my case, inches). In the beginning of the capture, these two bytes were <code>01:44</code>, and at the end they were <code>01:53</code>. If we turn these two bytes into a 16-bit number (<code>0x144</code> and <code>0x153</code>) we get <code>324</code> and <code>339</code> respectively. Success! We&#x27;ve determined which parts of the message represent the height, and all we need to do is divide by 10 to get the resulting height.</p>
<p>Since the first two bytes always appear to be the same, we can use those in our decoder to make sure we are actually about to receive the height message.</p>
<h2 class="anchor anchorWithStickyNavbar_UaZB" id="implementing-decoder">Implementing Decoder<a href="#implementing-decoder" class="hash-link" aria-label="Direct link to Implementing Decoder" title="Direct link to Implementing Decoder">​</a></h2>
<p>Using all the information we collected, we can create a simple state machine which represents the how we will decode the messages from the control box. We can create a state for each byte we expect in the four-byte message. In the actual implementation, these are named as follows:</p>
<ul>
<li><code>SYNC1</code></li>
<li><code>SYNC2</code></li>
<li><code>HEIGHT1</code></li>
<li><code>HEIGHT2</code></li>
</ul>
<p>As we receive each byte, we can determine the next state based on the byte that was received, and store the height when we encounter it. Here is a very amateurish FSM diagram representing our state machine:</p>
<p><img loading="lazy" src="/assets/images/fsm-479084a4e84b4d7e71c2ae921fe85f64.png" width="934" height="390" class="img_uglp"></p>
<p>And here is the actual implementation that this state machine represents:</p>
<div class="language-cpp codeBlockContainer_k_qd theme-code-block" style="--prism-color:#9CDCFE;--prism-background-color:#1E1E1E"><div class="codeBlockContent_I7Jj"><pre tabindex="0" class="prism-code language-cpp codeBlock_X9_o thin-scrollbar" style="color:#9CDCFE;background-color:#1E1E1E"><code class="codeBlockLines_xT00"><span class="token-line" style="color:#9CDCFE"><span class="token keyword" style="color:rgb(86, 156, 214)">bool</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(78, 201, 176)">UpliftDecoder</span><span class="token double-colon punctuation" style="color:rgb(212, 212, 212)">::</span><span class="token function" style="color:rgb(220, 220, 170)">put</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token keyword" style="color:rgb(86, 156, 214)">uint8_t</span><span class="token plain"> b</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token keyword" style="color:rgb(86, 156, 214)">switch</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">state_</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token keyword" style="color:rgb(86, 156, 214)">case</span><span class="token plain"> SYNC1</span><span class="token operator" style="color:rgb(212, 212, 212)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token keyword" style="color:rgb(86, 156, 214)">if</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">b </span><span class="token operator" style="color:rgb(212, 212, 212)">==</span><span class="token plain"> </span><span class="token number" style="color:rgb(181, 206, 168)">0x01</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">      state_ </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> SYNC2</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">      </span><span class="token keyword" style="color:rgb(86, 156, 214)">return</span><span class="token plain"> </span><span class="token boolean">false</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">else</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">      state_ </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> SYNC1</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">      </span><span class="token keyword" style="color:rgb(86, 156, 214)">return</span><span class="token plain"> </span><span class="token boolean">false</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token keyword" style="color:rgb(86, 156, 214)">case</span><span class="token plain"> SYNC2</span><span class="token operator" style="color:rgb(212, 212, 212)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token keyword" style="color:rgb(86, 156, 214)">if</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">b </span><span class="token operator" style="color:rgb(212, 212, 212)">==</span><span class="token plain"> </span><span class="token number" style="color:rgb(181, 206, 168)">0x01</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">      state_ </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> HEIGHT1</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">      </span><span class="token keyword" style="color:rgb(86, 156, 214)">return</span><span class="token plain"> </span><span class="token boolean">false</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">else</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">      state_ </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> SYNC1</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">      </span><span class="token keyword" style="color:rgb(86, 156, 214)">return</span><span class="token plain"> </span><span class="token boolean">false</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token keyword" style="color:rgb(86, 156, 214)">case</span><span class="token plain"> HEIGHT1</span><span class="token operator" style="color:rgb(212, 212, 212)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token keyword" style="color:rgb(86, 156, 214)">if</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">b </span><span class="token operator" style="color:rgb(212, 212, 212)">==</span><span class="token plain"> </span><span class="token number" style="color:rgb(181, 206, 168)">0x00</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">||</span><span class="token plain"> b </span><span class="token operator" style="color:rgb(212, 212, 212)">==</span><span class="token plain"> </span><span class="token number" style="color:rgb(181, 206, 168)">0x01</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">      buf_</span><span class="token punctuation" style="color:rgb(212, 212, 212)">[</span><span class="token number" style="color:rgb(181, 206, 168)">0</span><span class="token punctuation" style="color:rgb(212, 212, 212)">]</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> b</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">      state_ </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> HEIGHT2</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">      </span><span class="token keyword" style="color:rgb(86, 156, 214)">return</span><span class="token plain"> </span><span class="token boolean">false</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">else</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">      state_ </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> SYNC1</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">      </span><span class="token keyword" style="color:rgb(86, 156, 214)">return</span><span class="token plain"> </span><span class="token boolean">false</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token keyword" style="color:rgb(86, 156, 214)">case</span><span class="token plain"> HEIGHT2</span><span class="token operator" style="color:rgb(212, 212, 212)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    buf_</span><span class="token punctuation" style="color:rgb(212, 212, 212)">[</span><span class="token number" style="color:rgb(181, 206, 168)">1</span><span class="token punctuation" style="color:rgb(212, 212, 212)">]</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> b</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    state_ </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> SYNC1</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token keyword" style="color:rgb(86, 156, 214)">return</span><span class="token plain"> </span><span class="token boolean">true</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token keyword" style="color:rgb(86, 156, 214)">default</span><span class="token operator" style="color:rgb(212, 212, 212)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token keyword" style="color:rgb(86, 156, 214)">return</span><span class="token plain"> </span><span class="token boolean">false</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token keyword" style="color:rgb(86, 156, 214)">return</span><span class="token plain"> </span><span class="token boolean">false</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><br></span></code></pre><div class="buttonGroup_TeVO"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_QMts" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_o2X6"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_xmLG"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Using this method, you should be able to write a decoder for your desk&#x27;s protocol. You can reference the source code for the existing decoders in <a href="https://github.com/tjhorner/esphome-standing-desk/tree/master/components/standing_desk_height" target="_blank" rel="noopener noreferrer">this repo</a>, which you may find helpful.</p></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-edit-meta-row row"><div class="col"><a href="https://github.com/tjhorner/upsy-desky-docs/edit/main/docs/advanced/reverse-engineering/index.md" target="_blank" rel="noopener noreferrer" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_r01N" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_BkTy"></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages"><a class="pagination-nav__link pagination-nav__link--prev" href="/docs/advanced/customization/"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Firmware Customization</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_H8E5 thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#capturing-messages" class="table-of-contents__link toc-highlight">Capturing Messages</a><ul><li><a href="#flashing-firmware" class="table-of-contents__link toc-highlight">Flashing Firmware</a></li><li><a href="#generating-captures" class="table-of-contents__link toc-highlight">Generating Captures</a></li></ul></li><li><a href="#analyzing-messages" class="table-of-contents__link toc-highlight">Analyzing Messages</a></li><li><a href="#implementing-decoder" class="table-of-contents__link toc-highlight">Implementing Decoder</a></li></ul></div></div></div></div></main></div></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Docs</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/docs/getting-started">Getting Started</a></li></ul></div><div class="col footer__col"><div class="footer__title">Community</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://discord.gg/ZHfXKQrSxF" target="_blank" rel="noopener noreferrer" class="footer__link-item">Discord<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_gOw0"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://github.com/tjhorner/upsy-desky" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_gOw0"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div><div class="col footer__col"><div class="footer__title">Shop</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://www.tindie.com/products/tjhorner/upsy-desky/" target="_blank" rel="noopener noreferrer" class="footer__link-item">Buy Upsy Desky on Tindie<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_gOw0"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2024 TJ Horner &mdash; provided under <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.en" target="_blank">CC BY-NC-SA 4.0</a></div></div></div></footer></div>
</body>
</html>