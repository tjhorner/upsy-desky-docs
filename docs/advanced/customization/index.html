<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper plugin-docs plugin-id-default docs-version-current docs-doc-page docs-doc-id-advanced/customization/index" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.0.0">
<title data-rh="true">Firmware Customization | Upsy Desky</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://upsy-desky.tjhorner.dev/docs/advanced/customization/"><meta data-rh="true" property="og:locale" content="en"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="Firmware Customization | Upsy Desky"><meta data-rh="true" name="description" content="Since the Upsy Desky&#x27;s firmware is based on ESPHome, making customizations to the firmware is as easy as editing some YAML. The best way to modify the firmware config is by installing the ESPHome Dashboard (or using it via cli)."><meta data-rh="true" property="og:description" content="Since the Upsy Desky&#x27;s firmware is based on ESPHome, making customizations to the firmware is as easy as editing some YAML. The best way to modify the firmware config is by installing the ESPHome Dashboard (or using it via cli)."><link data-rh="true" rel="icon" href="/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://upsy-desky.tjhorner.dev/docs/advanced/customization/"><link data-rh="true" rel="alternate" href="https://upsy-desky.tjhorner.dev/docs/advanced/customization/" hreflang="en"><link data-rh="true" rel="alternate" href="https://upsy-desky.tjhorner.dev/docs/advanced/customization/" hreflang="x-default"><link data-rh="true" rel="preconnect" href="https://N36PZOL6ZV-dsn.algolia.net" crossorigin="anonymous"><link rel="search" type="application/opensearchdescription+xml" title="Upsy Desky" href="/opensearch.xml">
<link rel="preconnect" href="https://umami.horner.tj">
<script async defer="defer" src="https://umami.horner.tj/umami.js" data-website-id="d23d5a58-51a7-47a7-a3dd-2793734b2e5c" data-auto-track></script><link rel="stylesheet" href="/assets/css/styles.da4159ff.css">
<script src="/assets/js/runtime~main.50bec74f.js" defer="defer"></script>
<script src="/assets/js/main.faeb01c8.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return localStorage.getItem("theme")}catch(t){}}();null!==e?t(e):window.matchMedia("(prefers-color-scheme: dark)").matches?t("dark"):window.matchMedia("(prefers-color-scheme: light)").matches?t("light"):t("dark")}(),function(){try{const c=new URLSearchParams(window.location.search).entries();for(var[t,e]of c)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id="__docusaurus"><div role="region" aria-label="Skip to main content"><a class="skipToContent_Jej2" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/logo-long.png" alt="Upsy Desky Logo" class="themedComponent_DJv9 themedComponent--light_Ltxe"><img src="/img/logo-inverted.png" alt="Upsy Desky Logo" class="themedComponent_DJv9 themedComponent--dark_YIaN"></div></a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/docs/introduction">Docs</a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/tjhorner/upsy-desky" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_gOw0"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><a href="https://discord.gg/ZHfXKQrSxF" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">Discord<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_gOw0"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><div class="toggle_Q8DZ colorModeToggle_WPKh"><button class="clean-btn toggleButton_xX3B toggleButtonDisabled_T3va" type="button" disabled="" title="Switch between dark and light mode (currently dark mode)" aria-label="Switch between dark and light mode (currently dark mode)" aria-live="polite"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_UxP5"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_qIBZ"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="navbarSearchContainer_tMLQ"><button type="button" class="DocSearch DocSearch-Button" aria-label="Search"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">Search</span></span><span class="DocSearch-Button-Keys"></span></button></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_pjZQ"><div class="docsWrapper_yNJd"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_rsKc" type="button"></button><div class="docRoot_lvFb"><aside class="theme-doc-sidebar-container docSidebarContainer_SbV2"><div class="sidebarViewport_ltWh"><div class="sidebar_ZanS"><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_jUB4"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/introduction">Introduction</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/getting-started">Getting Started</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/byoe/">BYOE (Bring-Your-Own-Enclosure)</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/docs/configuration/">Configuration</a><button aria-label="Expand sidebar category &#x27;Configuration&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/docs/integrations/">Integrations</a><button aria-label="Expand sidebar category &#x27;Integrations&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/firmware-updates">Firmware Updates</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/docs/troubleshooting/">Troubleshooting &amp; Support</a><button aria-label="Expand sidebar category &#x27;Troubleshooting &amp; Support&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/docs/reference/api">Reference</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" aria-expanded="true" href="/docs/advanced/bluetooth-proxy">Advanced</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/advanced/bluetooth-proxy">Bluetooth Proxy</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/docs/advanced/customization/">Firmware Customization</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/advanced/reverse-engineering/">Reverse Engineering Guide</a></li></ul></li></ul></nav></div></div></aside><main class="docMainContainer_wO2h"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_pLOy"><div class="docItemContainer_tLNI"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer__LN5" aria-label="Breadcrumbs"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YWeh"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li class="breadcrumbs__item"><span class="breadcrumbs__link">Advanced</span><meta itemprop="position" content="1"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">Firmware Customization</span><meta itemprop="position" content="2"></li></ul></nav><div class="tocCollapsible_sW8G theme-doc-toc-mobile tocMobile_x9Gm"><button type="button" class="clean-btn tocCollapsibleButton_hfjZ">On this page</button></div><div class="theme-doc-markdown markdown"><h1>Firmware Customization</h1>
<p>Since the Upsy Desky&#x27;s firmware is based on <a href="https://esphome.io" target="_blank" rel="noopener noreferrer">ESPHome</a>, making customizations to the firmware is as easy as editing some YAML. The best way to modify the firmware config is by installing the <a href="https://esphome.io/guides/getting_started_hassio.html" target="_blank" rel="noopener noreferrer">ESPHome Dashboard</a> (or using it <a href="https://esphome.io/guides/getting_started_command_line.html" target="_blank" rel="noopener noreferrer">via cli</a>).</p>
<h2 class="anchor anchorWithStickyNavbar_UaZB" id="adopting-the-device">Adopting the Device<a href="#adopting-the-device" class="hash-link" aria-label="Direct link to Adopting the Device" title="Direct link to Adopting the Device">​</a></h2>
<p>Once ESPHome Dashboard is running, and your Upsy Desky is <a href="/docs/getting-started">connected to your network</a>, it should prompt you to adopt it.</p>
<p><img loading="lazy" src="/assets/images/adopt-eadc99057d2358636c119d3420d37388.png" width="1292" height="464" class="img_uglp"></p>
<p>Go through the adoption flow; it will do these things:</p>
<ol>
<li>Create an ESPHome configuration file</li>
<li>Set an API encryption key (used by Home Assistant or other native API consumers)</li>
<li>Bake the Wi-Fi credentials into the firmware</li>
<li>Install the new firmware to the device</li>
</ol>
<h2 class="anchor anchorWithStickyNavbar_UaZB" id="modifying-the-configuration">Modifying the Configuration<a href="#modifying-the-configuration" class="hash-link" aria-label="Direct link to Modifying the Configuration" title="Direct link to Modifying the Configuration">​</a></h2>
<p>Once ESPHome Dashboard is finished adopting the device, you will see a new node for your Upsy Desky by the name of <code>upsy-desky-XXXXXX</code>, where <code>XXXXXX</code> is derived from the MAC address of the device. Click on the edit button to see the config file.</p>
<p>It should look something like the following:</p>
<div class="language-yaml codeBlockContainer_k_qd theme-code-block" style="--prism-color:#9CDCFE;--prism-background-color:#1E1E1E"><div class="codeBlockContent_I7Jj"><pre tabindex="0" class="prism-code language-yaml codeBlock_X9_o thin-scrollbar" style="color:#9CDCFE;background-color:#1E1E1E"><code class="codeBlockLines_xT00"><span class="token-line" style="color:#9CDCFE"><span class="token key atrule">substitutions</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token key atrule">name</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token plain"> upsy</span><span class="token punctuation" style="color:rgb(212, 212, 212)">-</span><span class="token plain">desky</span><span class="token punctuation" style="color:rgb(212, 212, 212)">-</span><span class="token plain">cf32ec</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token key atrule">packages</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token comment" style="color:rgb(106, 153, 85)"># Change the line below to reference `base.yaml` instead, if you want the</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token comment" style="color:rgb(106, 153, 85)"># base config (see next section for details)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token key atrule">tj_horner.upsy_desky</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token plain"> github</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token plain">//tjhorner/upsy</span><span class="token punctuation" style="color:rgb(212, 212, 212)">-</span><span class="token plain">desky/firmware/stock.yaml@v1.0.3</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token key atrule">esphome</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token key atrule">name</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token plain"> $</span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain">name</span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token key atrule">name_add_mac_suffix</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token plain"> </span><span class="token boolean important">false</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token key atrule">api</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token key atrule">encryption</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token key atrule">key</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token plain"> your</span><span class="token punctuation" style="color:rgb(212, 212, 212)">-</span><span class="token plain">encryption</span><span class="token punctuation" style="color:rgb(212, 212, 212)">-</span><span class="token plain">key</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token key atrule">wifi</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token key atrule">ssid</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token plain"> </span><span class="token tag" style="color:rgb(78, 201, 176)">!secret</span><span class="token plain"> wifi_ssid</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token key atrule">password</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token plain"> </span><span class="token tag" style="color:rgb(78, 201, 176)">!secret</span><span class="token plain"> wifi_password</span><br></span></code></pre><div class="buttonGroup_TeVO"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_QMts" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_o2X6"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_xmLG"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>It is pretty barebones, but this is because it references the <a href="https://github.com/tjhorner/upsy-desky/blob/master/firmware/stock.yaml" target="_blank" rel="noopener noreferrer">stock firmware config</a> as a package, which contains all the components necessary for it to work. You can add other components to the config as you wish; for example, you might want to turn your Upsy Desky into a <a href="https://esphome.io/components/bluetooth_proxy.html" target="_blank" rel="noopener noreferrer">Bluetooth proxy</a> in order to extend Home Assistant&#x27;s Bluetooth range.</p>
<p>There are also some substitutions you can declare which will change the behavior in the firmware, most notably is <code>friendly_name</code>, which changes the &quot;friendly name&quot; in each of the sensors. (See also: <a href="/docs/configuration/renaming/">Renaming the Device</a>)</p>
<h3 class="anchor anchorWithStickyNavbar_UaZB" id="trimming-the-firmware">Trimming the Firmware<a href="#trimming-the-firmware" class="hash-link" aria-label="Direct link to Trimming the Firmware" title="Direct link to Trimming the Firmware">​</a></h3>
<p>When Upsy Desky units are shipped out, they are flashed with an ESPHome config that contains the <a href="https://github.com/tjhorner/upsy-desky/blob/master/firmware/base.yaml" target="_blank" rel="noopener noreferrer">base config</a> (with all the components for height decoding, presets, etc.) as well as some components which are helpful for users that do not use ESPHome or Home Assistant, as well as some components to improve the out of box experience (e.g., captive portal, Improv serial, etc.).</p>
<p>This is also the config that ESPHome Dashboard will adopt the device with, in order to minimize friction when initially adopting the device. However, there are likely components in there that you do not need. Switching to the base config will significantly reduce the firmware size — by about 66% — and removes some components that may be insecure.</p>
<p>You can review the stock firmware config <a href="https://github.com/tjhorner/upsy-desky/blob/master/firmware/stock.yaml" target="_blank" rel="noopener noreferrer">here</a> and determine if you are using any components from that config. If you aren&#x27;t, you can switch to the base config easily: just change the reference from <code>stock.yaml</code> to <code>base.yaml</code>.</p>
<p>But if you are using a feature from the stock config and it is not in the base config, you will need to add it to your config manually by copy-pasting the section from <code>stock.yaml</code>. For example, if you want to use the base config, but still retain the <code>web_server</code> component, your config would look something like this:</p>
<div class="language-yaml codeBlockContainer_k_qd theme-code-block" style="--prism-color:#9CDCFE;--prism-background-color:#1E1E1E"><div class="codeBlockContent_I7Jj"><pre tabindex="0" class="prism-code language-yaml codeBlock_X9_o thin-scrollbar" style="color:#9CDCFE;background-color:#1E1E1E"><code class="codeBlockLines_xT00"><span class="token-line" style="color:#9CDCFE"><span class="token key atrule">substitutions</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token key atrule">name</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token plain"> upsy</span><span class="token punctuation" style="color:rgb(212, 212, 212)">-</span><span class="token plain">desky</span><span class="token punctuation" style="color:rgb(212, 212, 212)">-</span><span class="token plain">cf32ec</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token key atrule">packages</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token key atrule">tj_horner.upsy_desky</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token plain"> github</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token plain">//tjhorner/upsy</span><span class="token punctuation" style="color:rgb(212, 212, 212)">-</span><span class="token plain">desky/firmware/base.yaml@v1.0.3</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token key atrule">esphome</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token key atrule">name</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token plain"> $</span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain">name</span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token key atrule">name_add_mac_suffix</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token plain"> </span><span class="token boolean important">false</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token key atrule">api</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token key atrule">encryption</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token key atrule">key</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token plain"> your</span><span class="token punctuation" style="color:rgb(212, 212, 212)">-</span><span class="token plain">encryption</span><span class="token punctuation" style="color:rgb(212, 212, 212)">-</span><span class="token plain">key</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token key atrule">wifi</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token key atrule">ssid</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token plain"> </span><span class="token tag" style="color:rgb(78, 201, 176)">!secret</span><span class="token plain"> wifi_ssid</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token key atrule">password</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token plain"> </span><span class="token tag" style="color:rgb(78, 201, 176)">!secret</span><span class="token plain"> wifi_password</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token comment" style="color:rgb(106, 153, 85)"># Copied from stock.yaml: https://github.com/tjhorner/upsy-desky/blob/b238eb40c3203c3af9be2d2b0f8bde571941091e/firmware/stock.yaml#LL19-L20C11</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token key atrule">web_server</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token key atrule">port</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token plain"> </span><span class="token number" style="color:rgb(181, 206, 168)">80</span><br></span></code></pre><div class="buttonGroup_TeVO"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_QMts" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_o2X6"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_xmLG"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_UaZB" id="updating-base-config">Updating Base Config<a href="#updating-base-config" class="hash-link" aria-label="Direct link to Updating Base Config" title="Direct link to Updating Base Config">​</a></h3>
<p>When you first adopt the device, the package reference is locked to a specific version of the config so as not to cause breaking changes. You can either set this to <code>master</code> in order to always get the latest config, or to a specific version tag (see all the releases <a href="https://github.com/tjhorner/upsy-desky/releases" target="_blank" rel="noopener noreferrer">here</a>).</p>
<h2 class="anchor anchorWithStickyNavbar_UaZB" id="understanding-the-configuration">Understanding the Configuration<a href="#understanding-the-configuration" class="hash-link" aria-label="Direct link to Understanding the Configuration" title="Direct link to Understanding the Configuration">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_UaZB" id="addons">Addons<a href="#addons" class="hash-link" aria-label="Direct link to Addons" title="Direct link to Addons">​</a></h3>
<p>To keep things maintainable, each large part of the configuration is broken up into its own &quot;addon&quot;. There are currently three addons, all of which are included in the base config:</p>
<ul>
<li><code>presets.yaml</code>: Configuration necessary for recalling and setting desk presets</li>
<li><code>runtime-config.yaml</code>: Entities related to configuration of the device at runtime</li>
<li><code>stable-ids.yaml</code>: Provides stable IDs for the web API</li>
</ul>
<p>You can see the source for all the addons <a href="https://github.com/tjhorner/upsy-desky/tree/master/firmware/addons" target="_blank" rel="noopener noreferrer">here</a>.</p></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-edit-meta-row row"><div class="col"><a href="https://github.com/tjhorner/upsy-desky-docs/edit/main/docs/advanced/customization/index.md" target="_blank" rel="noopener noreferrer" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_r01N" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_BkTy"></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages"><a class="pagination-nav__link pagination-nav__link--prev" href="/docs/advanced/bluetooth-proxy"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Bluetooth Proxy</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/docs/advanced/reverse-engineering/"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Reverse Engineering Guide</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_H8E5 thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#adopting-the-device" class="table-of-contents__link toc-highlight">Adopting the Device</a></li><li><a href="#modifying-the-configuration" class="table-of-contents__link toc-highlight">Modifying the Configuration</a><ul><li><a href="#trimming-the-firmware" class="table-of-contents__link toc-highlight">Trimming the Firmware</a></li><li><a href="#updating-base-config" class="table-of-contents__link toc-highlight">Updating Base Config</a></li></ul></li><li><a href="#understanding-the-configuration" class="table-of-contents__link toc-highlight">Understanding the Configuration</a><ul><li><a href="#addons" class="table-of-contents__link toc-highlight">Addons</a></li></ul></li></ul></div></div></div></div></main></div></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Docs</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/docs/getting-started">Getting Started</a></li></ul></div><div class="col footer__col"><div class="footer__title">Community</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://discord.gg/ZHfXKQrSxF" target="_blank" rel="noopener noreferrer" class="footer__link-item">Discord<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_gOw0"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://github.com/tjhorner/upsy-desky" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_gOw0"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div><div class="col footer__col"><div class="footer__title">Shop</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://www.tindie.com/products/tjhorner/upsy-desky/" target="_blank" rel="noopener noreferrer" class="footer__link-item">Buy Upsy Desky on Tindie<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_gOw0"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2024 TJ Horner &mdash; provided under <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.en" target="_blank">CC BY-NC-SA 4.0</a></div></div></div></footer></div>
</body>
</html>